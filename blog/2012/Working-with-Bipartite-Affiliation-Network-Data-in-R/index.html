<!DOCTYPE html>
<html>

  <!-- Mathjax Support -->
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Solomon Messing | Working with Bipartite/Affiliation Network Data in R</title>
  <meta name="description" content="Research Scientist. Manager of data science for Social Science One at  Facebook, former (founding) Director at Pew Research Center’s Data Labs.
">

  <link rel="shortcut icon" href="/assets/img/favicon.ico">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="canonical" href="/blog/2012/Working-with-Bipartite-Affiliation-Network-Data-in-R/">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
        
        <strong>Solomon Messing</strong>
    </span>
    

    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

      <div class="trigger">
        <!-- About -->
        <a class="page-link" href="/">about</a>

        <!-- CV -->
        <a class="page-link" href="/assets/pdf/CV.pdf">CV</a>

        <!-- Blog -->
        <a class="page-link" href="/blog/">blog</a>


        <!-- Pages -->
        
          
        
          
        
          
        
          
        
          
            <a class="page-link" href="/projects/">projects</a>
          
        
          
            <a class="page-link" href="/publications/">publications</a>
          
        
          
            <a class="page-link" href="/teaching/">teaching</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

        <!-- CV link -->
        <!-- <a class="page-link" href="/assets/pdf/CV.pdf">vitae</a> -->

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Working with Bipartite/Affiliation Network Data in R</h1>
    <p class="post-meta">October 30, 2012</p>
  </header>

  <article class="post-content">
    <p><img src="/assets/img/2mode.jpeg" alt="" /></p>

<p>Data can often be usefully conceptualized in terms affiliations between people (or other key data entities). It might be useful analyze common group membership, common purchasing decisions, or common patterns of behavior. This post introduces bipartite/affiliation network data and provides R code to help you process and visualize this kind of data. I recently updated this for use with larger data sets, though I put it together a while back.</p>

<h2 id="preliminaries">Preliminaries</h2>

<p>Much of the material here is covered in the more comprehensive <a href="http://sna.stanford.edu/rlabs.php">“Social Network Analysis Labs in R and SoNIA,”</a> on which I collaborated with Dan McFarland, Sean Westwood and Mike Nowak.
For a great online introduction to social network analysis see the online book <a href="http://www.faculty.ucr.edu/~hanneman/nettext/">Introduction to Social Network Methods</a> by Robert Hanneman and Mark Riddle.</p>

<h2 id="bipartiteaffiliation-network-data">Bipartite/Affiliation Network Data</h2>

<p>A network can consist of different ‘classes’ of nodes. For example, a two-mode network might consist of people (the first mode) and groups in which they are members (the second mode). Another very common example of two-mode network data consists of users on a particular website who communicate in the same forum thread.
Here’s a short example of this kind of data. Run this in R for yourself - just copy an paste into the command line or into a script and it will generate a dataframe that we can use for illustrative purposes:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w"> 
    </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Sam'</span><span class="p">,</span><span class="s1">'Sam'</span><span class="p">,</span><span class="s1">'Sam'</span><span class="p">,</span><span class="s1">'Greg'</span><span class="p">,</span><span class="s1">'Tom'</span><span class="p">,</span><span class="s1">'Tom'</span><span class="p">,</span><span class="s1">'Tom'</span><span class="p">,</span><span class="s1">'Mary'</span><span class="p">,</span><span class="s1">'Mary'</span><span class="p">),</span><span class="w"> 
    </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">'c'</span><span class="p">,</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">'c'</span><span class="p">,</span><span class="s1">'d'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">'d'</span><span class="p">),</span><span class="w"> 
    </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w">

</span><span class="n">person</span><span class="w"> </span><span class="n">group</span><span class="w">
</span><span class="m">1</span><span class="err">   </span><span class="w"> </span><span class="n">Sam</span><span class="err">    </span><span class="w"> </span><span class="n">a</span><span class="w">
</span><span class="m">2</span><span class="err">   </span><span class="w"> </span><span class="n">Sam</span><span class="err">    </span><span class="w"> </span><span class="n">b</span><span class="w">
</span><span class="m">3</span><span class="err">   </span><span class="w"> </span><span class="n">Sam</span><span class="err">    </span><span class="w"> </span><span class="n">c</span><span class="w">
</span><span class="m">4</span><span class="err">  </span><span class="w"> </span><span class="n">Greg</span><span class="err">    </span><span class="w"> </span><span class="n">a</span><span class="w">
</span><span class="m">5</span><span class="err">   </span><span class="w"> </span><span class="n">Tom</span><span class="err">    </span><span class="w"> </span><span class="n">b</span><span class="w">
</span><span class="m">6</span><span class="err">   </span><span class="w"> </span><span class="n">Tom</span><span class="err">    </span><span class="w"> </span><span class="n">c</span><span class="w">
</span><span class="m">7</span><span class="err">   </span><span class="w"> </span><span class="n">Tom</span><span class="err">    </span><span class="w"> </span><span class="n">d</span><span class="w">
</span><span class="m">8</span><span class="err">  </span><span class="w"> </span><span class="n">Mary</span><span class="err">    </span><span class="w"> </span><span class="n">b</span><span class="w">
</span><span class="m">9</span><span class="err">  </span><span class="w"> </span><span class="n">Mary</span><span class="err">    </span><span class="w"> </span><span class="n">d</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="c1">Fast, efficient two-mode to one-mode conversion in R</h2>

<p>Suppose we wish to analyze or visualize how the people are connected directly - that is, what if we want the network of people where a tie between two people is present if they are both members of the same group? We need to perform a two-mode to one-mode conversion.</p>

<p>To convert a two-mode incidence matrix to a one-mode adjacency matrix, one can simply multiply an incidence matrix by its transpose, which sum the common 1’s between rows. Recall that matrix multiplication entails multiplying the k-th entry of a row in the first matrix by the k-th entry of a column in the second matrix, then summing, such that the ij-th row-column entry in resulting matrix represents the dot-product of the i-th row of the first matrix and the j-th column of the second. In mathematical notation:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
AB =
  \left[ 
  \begin{array}{cc}
      a & b  \\
      c & d
  \end{array} 
  \right]
  \left[ 
  \begin{array}{cc}
      e & f  \\
      g & h
  \end{array} 
  \right]
 =
  \left[ 
  \begin{array}{cc}
    ae+bg & af+bh \\
    ce+dg & cf+dh
  \end{array} 
  \right]
\end{align*} %]]></script>

<p>Notice further that multiplying a matrix by its transpose yields the following:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
AA' =
  \left[ 
  \begin{array}{cc}
      a & b  \\
      c & d
  \end{array} 
  \right]
  \left[ 
  \begin{array}{cc}
      a & c  \\
      b & d
  \end{array} 
  \right]
 =
  \left[ 
  \begin{array}{cc}
    aa+bb & ac+bd \\
    ca+db & cc+dd
  \end{array} 
  \right]
\end{align*} %]]></script>

<p>Because our incidence matrix consists of 0’s and 1’s, the off-diagonal entries represent the total number of common columns, which is exactly what we wanted. We’ll use the <code class="language-r highlighter-rouge"><span class="o">%*%</span></code> operator to tell R to do exactly this. Let’s take a look at a small example using toy data of people and groups to which they belong. We’ll coerce the data to an incidence matrix, then multiply the incidence matrix by its transpose to get the number of common groups between people.</p>

<p>This is easy to do using the matrix algebra functions included in R. But first, you need to restructure your (edgelist) network data as an incidence matrix. An incidence will record a 1 for row-column combinations where a tie is present and 0 otherwise. One easy way to do this in R is to use the table function and then coerce the table object to a matrix object:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">m</span><span class="err"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">table</span><span class="p">(</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">M</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="err"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>If you are using the network or sna packages, a network object be coerced via <code class="language-r highlighter-rouge"><span class="n">as.matrix</span><span class="p">(</span><span class="n">your</span><span class="o">-</span><span class="n">network</span><span class="p">)</span></code>; with the igraph package use <code class="language-r highlighter-rouge"><span class="n">get.adjacency</span><span class="p">(</span><span class="n">your</span><span class="o">-</span><span class="n">network</span><span class="p">)</span></code>.</p>

<p>This is great, but what about if we are working with a really large data set? Network data is almost always sparse—there are far more pairwise combinations of potential connections than actual observed connections. Hence, we’d actually prefer to keep the underlying data structured in edgelist format, but we’d also like access to R’s matrix algebra functionality.</p>

<p>We can get the best of both worlds using the Matrix library to construct a sparse triplet representation of a matrix. But we’d also like to avoid building the entire incidence matrix and just feed Matrix our edgelist directly, a point that came up in a recent conversation I had with <a href="http://seanjtaylor.com/">Sean Taylor</a>. We feed <code class="language-r highlighter-rouge"><span class="n">Matrix</span></code> our ‘person’ column to index ‘i’ (rows in the new incidence matrix), our ‘group’ column to index j (columns in the new incidence matrix), and we repeat ‘1’ for the length of the edgelist to denote an incidence.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">library</span><span class="p">(</span><span class="s1">'Matrix'</span><span class="p">)</span><span class="w">
</span><span class="n">A</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spMatrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)),</span><span class="w">
</span><span class="n">ncol</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">)),</span><span class="w">
</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)),</span><span class="w">
</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">)),</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">row.names</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">))</span><span class="w">
</span><span class="n">A</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>We will either convert to the ‘mode’ represented by the columns or by the rows.
To get the one-mode representation of ties between rows (people in our example), multiply the matrix by its transpose. Note that you must use the matrix-multiplication operator <code class="language-r highlighter-rouge"><span class="o">%*%</span></code> rather than a simple astrisk. The R code is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Arow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>But we can still do better! The function tcrossprod is faster and more efficient for this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Arow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tcrossprod</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Arow will now represent the one-mode matrix formed by the row entities—people will have ties to each other if they are in the same group, in our example. Here’s what it looks like:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">Arow</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="n">Matrix</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="s2">"dgCMatrix"</span><span class="w">
     </span><span class="n">Greg</span><span class="w"> </span><span class="n">Mary</span><span class="w"> </span><span class="n">Sam</span><span class="w"> </span><span class="n">Tom</span><span class="w">
</span><span class="n">Greg</span><span class="w">    </span><span class="m">1</span><span class="w">    </span><span class="n">.</span><span class="w">   </span><span class="m">1</span><span class="w">   </span><span class="n">.</span><span class="w">
</span><span class="n">Mary</span><span class="w">    </span><span class="n">.</span><span class="w">    </span><span class="m">2</span><span class="w">   </span><span class="m">1</span><span class="w">   </span><span class="m">2</span><span class="w">
</span><span class="n">Sam</span><span class="w">     </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w">   </span><span class="m">3</span><span class="w">   </span><span class="m">2</span><span class="w">
</span><span class="n">Tom</span><span class="w">     </span><span class="n">.</span><span class="w">    </span><span class="m">2</span><span class="w">   </span><span class="m">2</span><span class="w">   </span><span class="m">3</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>To get the one-mode matrix formed by the column entities (i.e. the number of people) enter the following command:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Acol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">A</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Again, we can use tcrossprod to make this even more efficient:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Acol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tcrossprod</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>And the resulting co-membership matrix is as follows:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">Mcol</span><span class="w">
</span><span class="n">group</span><span class="w">
</span><span class="n">group</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">d</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="n">b</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">c</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Although we’ve used a very small network for our example, this code is highly extensible to the analysis of larger networks with R.</p>

<h2 id="c1">Analysis of Two Mode Data and Mobility</h2>

<p>Let’s work with some actual affiliation data, collected by Dan McFarland on student extracurricular affiliations. It’s a longitudinal data set, with 3 waves - 1996, 1997, 1998.  It consists of students (anonymized) and the student organizations in which they are members (e.g. National Honor Society, wrestling team, cheerleading squad, etc.).
What we’ll do is to read in the data, explore it, make a few two-to-one mode conversions, and visualize it.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1"># Load the 'igraph' library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s1">'igraph'</span><span class="p">)</span><span class="w">
</span><span class="c1"># (1) Read in the data files, NA data objects coded as 'na'</span><span class="w">
</span><span class="n">magact96</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s1">'https://solomonmg.github.io/assets/img/mag_act96.txt'</span><span class="p">,</span><span class="w">
</span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'na'</span><span class="p">)</span><span class="w">
</span><span class="n">magact97</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s1">'https://solomonmg.github.io/assets/img/mag_act97.txt'</span><span class="p">,</span><span class="w">
</span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'na'</span><span class="p">)</span><span class="w">
</span><span class="n">magact98</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s1">'https://solomonmg.github.io/assets/img/mag_act98.txt'</span><span class="p">,</span><span class="w">
</span><span class="n">na.strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'na'</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Missing data is coded as “na” in this data, which is why we gave R the command na.strings = “na”.</p>

<p>These files consist of four columns of individual-level attributes (ID, gender, grade, race), then a bunch of group membership dummy variables (coded “1” for membership, “0” for no membership).  We need to set aside the first four columns (which do not change from year to year).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">magattrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magact96</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="n">g96</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">magact96</span><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]);</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">g96</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magact96</span><span class="o">$</span><span class="n">ID.</span><span class="w">
</span><span class="n">g97</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">magact97</span><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]);</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magact97</span><span class="o">$</span><span class="n">ID.</span><span class="w">
</span><span class="n">g98</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">magact98</span><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]);</span><span class="w"> </span><span class="n">row.names</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magact98</span><span class="o">$</span><span class="n">ID.</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>By using the <code class="language-r highlighter-rouge"><span class="p">[,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]</span></code> index, we drop those columns so that we have a square incidence matrix for each year, and then tell R to set the row names of the matrix to the student’s ID. Note that we need to keep the “.” after ID in this dataset (because it’s in the name of the variable).
Now we load these two-mode matrices into igraph:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">i96</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.incidence</span><span class="p">(</span><span class="n">g96</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">i97</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.incidence</span><span class="p">(</span><span class="n">g97</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">i98</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.incidence</span><span class="p">(</span><span class="n">g98</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="plotting-two-mode-networks">Plotting two-mode networks</h3>

<p>Now, let’s plot these graphs. The igraph package has excellent plotting functionality that allows you to assign visual attributes to igraph objects before you plot. The alternative is to pass 20 or so arguments to the <code class="language-r highlighter-rouge"><span class="n">plot.igraph</span><span class="p">()</span></code> function, which gets really messy.</p>

<p>Let’s assign some attributes to our graph. First we set vertex attributes, making sure to make them slightly transparent by altering the gamma, using the <code class="language-r highlighter-rouge"><span class="n">rgb</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">gamma</span><span class="p">)</span></code> function to set the color. This makes it much easier to look at a really crowded graph, which might look like a giant hairball otherwise.
You can read up on the RGB color model <a href="http://en.wikipedia.org/wiki/RGB_color_model">here</a>.</p>

<p>Each node (or “vertex”) object is accessible by calling <code class="language-r highlighter-rouge"><span class="n">V</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></code>, and you can call (or create) a node attribute by using the <code class="language-r highlighter-rouge"><span class="o">$</span></code> operator so that you call <code class="language-r highlighter-rouge"><span class="n">V</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">$</span><span class="n">attribute</span></code>. Here’s how to set the color attribute for a set of nodes in a graph object:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">1295</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="p">[</span><span class="m">1296</span><span class="o">:</span><span class="m">1386</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Notice that we index the <code class="language-r highlighter-rouge"><span class="n">V</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">$</span><span class="n">color</span></code> object by a seemingly arbitrary value, 1295.  This marks the end of the student nodes, and 1296 is the first group node. You can view which nodes are which by typing V(i96). R prints out a list of all the nodes in the graph, and those with a number are obviously different from those that consist of a group name.</p>

<p>Now we’ll set some other graph attributes:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.4</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>You can also set edge attributes. Here we’ll make the edges nearly transparent and slightly yellow because there will be so many edges in this graph:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Now, we’ll open a pdf “device” on which to plot. This is just a connection to a pdf file. Note that the code below will take a minute or two to execute (or longer if you have a pre- Intel dual-core processor).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">pdf</span><span class="p">(</span><span class="s1">'i96.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that we’ve used the Fruchterman-Reingold force-directed layout algorithm here.  Generally speaking, the when you have a ton of edges, the Kamada-Kawai layout algorithm works well but, it can get really slow for networks with a lot of nodes. Also, for larger networks, layout.fruchterman.reingold.grid is faster, but can fail to produce a plot with any meaninful pattern if you have too many isolates, as is the case here. Experiment for yourself.
Here’s what we get:</p>

<p><img src="/assets/img/i96.jpg" alt="" /></p>

<p>It’s oddly reminiscent of a cresent and star, but impossible to read. Now, if you open the <a href="/assets/img/i96.pdf">pdf output</a>, you’ll notice that you can zoom in on any part of the graph ad infinitum without losing any resolution. How is that possible in such a small file? It’s possible because the pdf device output consists of data based on vectors: lines, polygons, circles, elipses, etc., each specified by a mathematical formula that your pdf program renders when you view it. Regular bitmap or jpeg picture output, on the other hand, consists of a pixel-coordinate mapping of the image in question, which is why you lose resolution when you zoom in on a digital photograph or a plot produced with most other programs.</p>

<p>Let’s remove all of the isolates (the cresent), change a few aesthetic features, and replot. First, we’ll remove isloates, by deleting all nodes with a degree of 0, meaning that they have zero edges. Then, we’ll suppress labels for students and make their nodes smaller and more transparent. Then we’ll make the edges more narrow more transparent. Then, we’ll replot using various layout algorithms:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">i96</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">delete.vertices</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)[</span><span class="w"> </span><span class="n">degree</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">==</span><span class="m">0</span><span class="w"> </span><span class="p">])</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">857</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">857</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="err"> </span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.1</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">size</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">857</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">width</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.3</span><span class="w">
</span><span class="n">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.1</span><span class="p">)</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="s1">'i96.2.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.kamada.kawai</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="s1">'i96.3.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold.grid</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span><span class="n">pdf</span><span class="p">(</span><span class="s1">'i96.4.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>I personally prefer the Fruchterman-Reingold layout in this case. The nice thing about this layout is that it really emphasizes centrality–the nodes that are most central are nearly always placed in the middle of the plot. Here’s what it looks like:</p>

<p><img src="/assets/img/i962.jpg" alt="" /></p>

<p>Very pretty, but you can’t see which groups are which at this resolution. Zoom in on the <a href="/assets/img/samplepdf.pdf">pdf output</a>, and you can see things pretty clearly.</p>

<h3 id="two-mode-to-one-mode-data-transformation">Two mode to one mode data transformation</h3>

<p>We’ve emphasized groups in this visualization so much, that we might want to just create a network consisting of group co-membership. First we need to create a new network object. We’ll do that the same way for this network as for our example at the top of this page:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">g96e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">g96</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">g96</span><span class="w">
</span><span class="n">g97e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">g97</span><span class="w">
</span><span class="n">g98e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">g98</span><span class="w">
</span><span class="n">i96e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.adjacency</span><span class="p">(</span><span class="n">g96e</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'undirected'</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we need to tansform the graph so that multiple edges become an attribute ( <code class="language-r highlighter-rouge"><span class="n">E</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span></code> ) of each unique edge:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count.multiple</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="w">
</span><span class="n">i96e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">simplify</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we’ll set the other plotting parameters as we did above:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># Set vertex attributes</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.8</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.6</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span><span class="c1"># Set edge gamma according to edge weight</span><span class="w">
</span><span class="n">egam</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="m">+.3</span><span class="p">)</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="m">+.3</span><span class="p">)</span><span class="w">
</span><span class="n">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">egam</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>We set edge gamma as a function of how many edges exist between two nodes, or in this case, how many students each group has in common. For illustrative purposes, let’s compare how the Kamada-Kawai and Fruchterman-Reingold algorithms render this graph:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">pdf</span><span class="p">(</span><span class="s1">'i96e.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96e</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'layout.kamada.kawai'</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.kamada.kawai</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">i96e</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'layout.fruchterman.reingold'</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>I like the Kamada-Kawai layout for this graph, because the center of the graph is too busy otherwise. And here’s what the resulting plot looks like:
<img src="/assets/img/i96e-kk.jpeg" alt="" /></p>

<p>You can check out the difference between each layout yourself. Here’s what the <a href="/assets/img/i96e.pdf">pdf output looks like</a>.  Page 1 shows the Kamada-Kawai layout and page 2 shows the Fruchterman Reingold layout.</p>

<h3 id="group-overlap-networks-and-plots">Group overlap networks and plots</h3>

<p>Now we might also be interested in the percent overlap between groups. Note that this will be a directed graph, because the percent overlap will not be symmetric across groups–for example, it may be that 3/4 of Spanish NHS members are in NHS, but only 1/8 of NHS members are in the Spanish NHS. We’ll create this graph for all years in our data (though we could do it for one year only).
First we’ll need to create a percent overlap graph. We start by dividing each row by the diagonal (this is really easy in R):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">ol96</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g96e</span><span class="o">/</span><span class="n">diag</span><span class="p">(</span><span class="n">g96e</span><span class="p">)</span><span class="w">
</span><span class="n">ol97</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g97e</span><span class="o">/</span><span class="n">diag</span><span class="p">(</span><span class="n">g97e</span><span class="p">)</span><span class="w">
</span><span class="n">ol98</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g98e</span><span class="o">/</span><span class="n">diag</span><span class="p">(</span><span class="n">g98e</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Next, sum the matricies and set any NA cells (caused by dividing by zero in the step above) to zero:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">magall</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ol96</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ol97</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ol98</span><span class="w">
</span><span class="n">magall</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">magall</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that magall now consists of a percent overlap matrix, but because we’ve summed over 3 years, the maximun is now 3 instead of 1.
Let’s compute average club size, by taking the mean across each value in each diagonal:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">magdiag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">g96e</span><span class="p">),</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">g97e</span><span class="p">),</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">g98e</span><span class="p">)),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Finally, we’ll generate centrality measures for magall. When we create the igraph object from our matrix, we need to set weighted=T because otherwise igraph dichotomizes edges at 1. This can distort our centrality measures because now edges represent  more than binary connections–they represent the percent of membership overlap.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">magallg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.adjacency</span><span class="p">(</span><span class="n">magall</span><span class="p">,</span><span class="w"> </span><span class="n">weighted</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="c1"># Degree</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">degree</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="w">
</span><span class="c1"># Betweenness centrality</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="o">$</span><span class="n">btwcnt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">betweenness</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Before we plot this, we should probably filter some of the edges, otherwise our graph will probably be too busy to make sense of visually.  Take a look at the distribution of connection strength by plotting the density of the magall matrix:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">plot</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">magall</span><span class="p">))</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/assets/img/densitymagall.jpeg" alt="" /></p>

<p>Nearly all of the edge weights are below 1–or in other words, the percent overlap for most clubs is less than 1/3. Let’s filter at 1, so that an edge will consists of group overlap of more than 1/3 of the group’s members in question.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">magallgt1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">magall</span><span class="w">
</span><span class="n">magallgt1</span><span class="p">[</span><span class="n">magallgt1</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
</span><span class="n">magallggt1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph.adjacency</span><span class="p">(</span><span class="n">magallgt1</span><span class="p">,</span><span class="w"> </span><span class="n">weighted</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="c1"># Removes loops:</span><span class="w">
</span><span class="n">magallggt1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">simplify</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">,</span><span class="w"> </span><span class="n">remove.multiple</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">remove.loops</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Before we do anything else, we’ll create a custom layout based on Fruchterman.-Ringold wherein we adjust the coordates by hand using the tkplot gui tool to make sure all of the labels are visible. This is very useful if you want to create a really sharp-looking network visualization for publication.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">magallggt1</span><span class="o">$</span><span class="n">layout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">layout.fruchterman.reingold</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w">
</span><span class="n">tkplot</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Let the plot load, then maximize the window, and select to View -&gt; Fit to Screen so that you get maximum resolution for this large graph. Now hand-place the nodes, making sure no labels overlap:
<img src="/assets/img/tkplotscreenshot.png" alt="" /></p>

<p>Pay special attention to whether the labels overlap (or might overlap if the font was bigger) along the vertical. Save the layout coordinates to the graph object:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">magallggt1</span><span class="o">$</span><span class="n">layout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tkplot.getcoords</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>We use “1” here because only if this was the first tkplot object you called. If you called tkplot a few times, use the last plot object. You can tell which object is visible because at the top of the tkplot interface, you’ll see something like “Graph plot 1” or in the case of my screenshot above “Graph plot 7” (it was the seventh time I called tkplot).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1"># Set vertex attributes</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.6</span><span class="p">)</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span><span class="w">
</span><span class="c1"># Set edge attributes</span><span class="w">
</span><span class="n">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">arrow.size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">.3</span><span class="w">
</span><span class="c1"># Set edge gamma according to edge weight</span><span class="w">
</span><span class="n">egam</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="m">+.1</span><span class="p">)</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="m">+.1</span><span class="p">)</span><span class="w">
</span><span class="n">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">egam</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>One thing that we can do with this graph is to set label size as a function of degree, which adds a “tag-cloud”-like element to the visualization:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="m">.3</span><span class="w">
</span><span class="c1">#note, unfortunately one must play with the formula above to get the</span><span class="w">
</span><span class="c1">#ratio just right</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Let’s plot the results:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">pdf</span><span class="p">(</span><span class="s1">'magallggt1customlayout.pdf'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Note that we used the custom layout, which because we made part of the igraph object magallggt1, we did not need to specify in plot command.
Here’s the <a href="/assets/img/magallggt1custom.pdf">pdf output</a>, and here’s what it looks like:</p>

<p><img src="/assets/img/magallggt1custom.png" alt="" /></p>

<p>This visualization reveals much more information about our network than our cresent-star visualization.</p>

  </article>

<!-- 
  
 -->



 



</div>

      </div>
    </div>

    <footer>

  <div class="wrapper">
    &copy; Copyright 2020 Solomon Messing.
    
    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


<!-- Load KaTeX -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
<script src="/assets/js/katex.js"></script>




<!-- Include custom icon fonts -->
<link rel="stylesheet" href="/assets/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/assets/css/academicons.min.css">

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27273977-1', 'auto');
ga('send', 'pageview');
</script>


  </body>

</html>
